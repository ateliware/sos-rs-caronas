{% extends "base.html" %}
{% load static %} 

{% block title %}SosRs|Carona{% endblock %}

{% block content %}
    <div class="container mt-1">
        <div class="my-4">
            <h2>Faça o seu cadastro! </h2>
            <p><small>Todos os campos são obrigatórios</small></p>
        </div>
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}

            <!--Display error variable-->
            {% if form.errors %}
            <div class="alert alert-danger">
                <p>Houveram erros ao efetuar seu cadastro. Por favor, verifique os dados preenchidos e tente novamente.</p>  
                {% for error in form.errors %}
                    <p>{{ error }}</p>
                {% endfor %}
            </div>
            {% endif %}
            
            <!-- Name Field -->
            <div class="form-group my-2">
                <label for="name">{{ form.name.label }}:</label>
                <input 
                    type="text" 
                    class="form-control" 
                    id="name" 
                    name="name"
                    placeholder="{{ form.name.field.widget.attrs.placeholder }}"
                    required
                >
                <!-- Display Name field errors -->
                {% if form.name.errors %}
                    <small class="text-danger">{{ form.name.errors }}</small>
                {% endif %}
            </div>

            <!-- Phone Field -->
            <div class="form-group my-2">
                <label for="name">{{ form.phone.label }}:</label>
                <input 
                    type="text" 
                    class="form-control" 
                    id="phone" 
                    name="phone"
                    placeholder="{{ form.phone.field.widget.attrs.placeholder }}"
                    required
                >
                <!-- Display phone field errors -->
                {% if form.phone.errors %}
                    <small class="text-danger">{{ form.phone.errors }}</small>
                {% endif %}
            </div>

            <!-- CPF Field -->
            <div class="form-group my-2">
                <label for="name">{{ form.cpf.label }}:</label>
                <input 
                    type="text" 
                    class="form-control" 
                    id="cpf" 
                    name="cpf"
                    placeholder="{{ form.cpf.field.widget.attrs.placeholder }}"
                    required
                >
                <!-- Display cpf field errors -->
                {% if form.cpf.errors %}
                    <small class="text-danger">{{ form.cpf.errors }}</small>
                {% endif %}
            </div>

            <!-- Birth Date Field -->
            <div class="form-group my-2">
                <label for="name">{{ form.birth_date.label }}:</label>
                <input 
                    type="date" 
                    class="form-control" 
                    id="birth_date" 
                    name="birth_date"
                    placeholder="{{ form.birth_date.field.widget.attrs.placeholder }}"
                    required
                >
                <!-- Display birth_date field errors -->
                {% if form.birth_date.errors %}
                    <small class="text-danger">{{ form.birth_date.errors }}</small>
                {% endif %}
            </div>

            <!-- State Field -->
            <div class="form-group my-2">
                <label for="name">{{ form.state_id.label }}:</label>
                <select name="state_id" id="state_id" class="form-select">
                    <option value="">Selecione um estado</option>
                    {% for state in states %}
                        <option value="{{ state.id }}">{{ state }}</option>
                    {% endfor %}
                </select>
                <!-- Display state field errors -->
                {% if form.state_id.errors %}
                    <small class="text-danger">{{ form.state_id.errors }}</small>
                {% endif %}
            </div>

            <!-- City Field -->
            <div class="form-group my-2">
                <label for="name">{{ form.city_id.label }}:</label>
                <select name="city_id" id="city_id" class="form-select">
                    <option value="">Selecione uma cidade</option>
                    {% for city in cities %}
                        <option value="{{ city.id }}">{{ city }}</option>
                    {% endfor %}
                </select>
                <!-- Display city field errors -->
                {% if form.city_id.errors %}
                    <small class="text-danger">{{ form.city_id.errors }}</small>
                {% endif %}
            </div>

            <!-- Emergency Contact Field -->
            <div class="form-group my-2">
                <label for="emergency_contact">{{ form.emergency_contact.label }}:</label>
                <input 
                    type="text" 
                    class="form-control" 
                    id="emergency_contact" 
                    name="emergency_contact"
                    placeholder="{{ form.emergency_contact.field.widget.attrs.placeholder }}"
                >
                <!-- Display emergency_contact field errors -->
                {% if form.emergency_contact.errors %}
                    <small class="text-danger">{{ form.emergency_contact.errors }}</small>
                {% endif %}
            </div>

            <!-- Emergency Phone Field -->
            <div class="form-group my-2">
                <label for="emergency_phone">{{ form.emergency_phone.label }}:</label>
                <input 
                    type="text" 
                    class="form-control" 
                    id="emergency_phone" 
                    name="emergency_phone"
                    placeholder="{{ form.emergency_phone.field.widget.attrs.placeholder }}"
                >
                <!-- Display emergency_phone field errors -->
                {% if form.emergency_phone.errors %}
                    <small class="text-danger">{{ form.emergency_phone.errors }}</small>
                {% endif %}
            </div>

            <!-- Document Picture Field -->
            <div class="form-group my-2">
                <label for="document_picture">{{ form.document_picture.label }}:</label>
                <input 
                    type="file" 
                    class="form-control-file" 
                    id="document_picture" 
                    name="document_picture"
                >
                <!-- Display document_picture field errors -->
                {% if form.document_picture.errors %}
                    <small class="text-danger">{{ form.document_picture.errors }}</small>
                {% endif %}
            </div>

            <!-- Password Field -->
            <div class="form-group my-2">
                <label for="password">{{ form.password.label }}:</label>
                <input 
                    type="password" 
                    class="form-control" 
                    id="password" 
                    name="password"
                    placeholder="{{ form.password.field.widget.attrs.placeholder }}"
                >
                <!-- Display password field errors -->
                {% if form.password.errors %}
                    <small class="text-danger">{{ form.password.errors }}</small>
                {% endif %}
            </div>

            <!-- Password Confirmation Field -->
            <div class="form-group my-2">
                <label for="password_confirmation">{{ form.password_confirmation.label }}:</label>
                <input 
                    type="password" 
                    class="form-control" 
                    id="password_confirmation" 
                    name="password_confirmation"
                    placeholder="{{ form.password_confirmation.field.widget.attrs.placeholder }}"
                >
                <!-- Display password_confirmation field errors -->
                {% if form.password_confirmation.errors %}
                    <small class="text-danger">{{ form.password_confirmation.errors }}</small>
                {% endif %}
            </div>

            <!-- LGPD acceptance Field -->
            <div class="form-group form-check my-2">
                <input 
                    type="checkbox" 
                    class="form-check-input" 
                    id="lgpd_acceptance" 
                    name="lgpd_acceptance"
                >
                <label class="form-check-label" for="lgpd_acceptance">
                    Declaro que li e estou de acordo com os 
                    <a href="#" data-bs-toggle="modal" data-bs-target="#termsModal">termos de uso e privacidade do site.</a>
                </label>
                <!-- Display lgpd_acceptance field errors -->
                {% if form.lgpd_acceptance.errors %}
                    <small class="text-danger">{{ form.lgpd_acceptance.errors }}</small>
                {% endif %}
            </div>            
            <!-- Error Message for Password Mismatch -->
            <div id="passwordError" class="text-danger mb-3" style="display: none;">As senhas informadas não conferem!</div>
            <!-- Submit Button -->
            <div class="my-4">
                <button type="submit" class="btn btn-primary">Cadastrar</button>
                <a href="{% url 'home' %}" class="btn btn-secondary">Cancelar</a>
            </div>
        </form>
    </div>
    
    <!-- Modal -->
    <div class="modal fade" id="termsModal" tabindex="-1" aria-labelledby="termsModalLabel" aria-hidden="true">
        <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
            <h5>Termos de uso | Versão {{ term_of_use.version }}</h5>
            <p>{{ term_of_use.content }}</p>
            <h5>Política de privacidade | Versão {{ privacy_policy.version }}</h5>
            <p>{{ privacy_policy.content }}</p>
            </div>
            <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
            </div>
        </div>
        </div>
    </div>
    <script>
        function validatePassword() {
            var password = document.getElementById('password').value;
            var confirmPassword = document.getElementById('password_confirmation').value;

            if (password !== confirmPassword) {
                document.getElementById('passwordError').style.display = 'block';
                return false;
            }

            return true;
        }
    </script>
{% endblock %}